import{j as t,B as v,k as f,r as w,H as _e,c as q,n as m,J,N as Q,w as S,K as ve,T as be,L as ee,O as E,Q as te,U as Ce,V as se,W as F,X as ne,Y as M,Z as K,_ as re,$ as ge,a0 as we,u as V,q as Pe,a1 as ke,b as oe,a2 as Ne,a3 as Ae,C as ae,a4 as Se,a5 as Te,a6 as $e,a7 as Le}from"./index-b4bbc475.js";import{C as Oe,B as z}from"./BaseModal-a817dc91.js";import{Z as le,a as G}from"./ZapAnimated-0d61c296.js";import{F as De,p as Fe,A as Ie,I as Be}from"./Fab-cd513d6e.js";import{R as Re,a as Ue,T as He}from"./TextFilter-58203f61.js";import{f as qe}from"./index-c84627cb.js";import{T as Z}from"./Toggle-ff6610c6.js";import{S as Ee}from"./Select-768b1051.js";import"./debounce-c1ba2006.js";const Me="_FlexCenter_1380a_1",Ke={FlexCenter:Me};function Ve({children:e}){return t.jsx("div",{className:Ke.FlexCenter,children:e})}const{useRef:Y,useEffect:ze}=f;function Ge({onClickPrimaryButton:e,onClickSecondaryButton:s}){const n=Y(null),r=Y(null);ze(()=>{n.current.focus()},[]);const o=a=>{a.code==="ArrowRight"?r.current.focus():a.code==="ArrowLeft"&&n.current.focus()};return t.jsxs("div",{onKeyDown:o,children:[t.jsx("h2",{children:"Close Connections?"}),t.jsx("p",{children:"Click [Yes] to close those connections that are still using the old selected proxy in this group"}),t.jsx("div",{style:{height:30}}),t.jsxs(Ve,{children:[t.jsx(v,{onClick:e,ref:n,children:"Yes"}),t.jsx("div",{style:{width:20}}),t.jsx(v,{onClick:s,ref:r,children:"No"})]})]})}const Ze="_header_1y9js_1",Ye="_arrow_1y9js_8",We="_isOpen_1y9js_13",Xe="_btn_1y9js_20",Je="_qty_1y9js_25",k={header:Ze,arrow:Ye,isOpen:We,btn:Xe,qty:Je};function ce({name:e,type:s,toggle:n,isOpen:r,qty:o}){const a=w.useCallback(l=>{l.preventDefault(),(l.key==="Enter"||l.key===" ")&&n()},[n]);return t.jsxs("div",{className:k.header,onClick:n,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[t.jsx("div",{children:t.jsx(_e,{name:e,type:s})}),typeof o=="number"?t.jsx("span",{className:k.qty,children:o}):null,t.jsx(v,{kind:"minimal",onClick:n,className:k.btn,title:"Toggle collapsible section",children:t.jsx("span",{className:q(k.arrow,{[k.isOpen]:r}),children:t.jsx(Oe,{size:20})})})]})}const{useMemo:Qe}=f;function et(e,s){return e.filter(n=>{const r=s[n];return r===void 0?!0:!("number"in r&&r.number===0)})}const L=(e,s)=>{if(e&&"number"in e&&e.number>0)return e.number;const n=s&&s.type;return n&&Q.indexOf(n)>-1?-1:999999},tt={Natural:e=>e,LatencyAsc:(e,s,n)=>e.sort((r,o)=>{const a=L(s[r],n&&n[r]),l=L(s[o],n&&n[o]);return a-l}),LatencyDesc:(e,s,n)=>e.sort((r,o)=>{const a=L(s[r],n&&n[r]);return L(s[o],n&&n[o])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((s,n)=>s>n?-1:s<n?1:0)};function st(e,s){const n=s.toLowerCase().split(" ").map(r=>r.trim()).filter(r=>!!r);return n.length===0?e:e.filter(r=>{let o=0;for(;o<n.length;o++){const a=n[o];if(r.toLowerCase().indexOf(a)>-1)return!0}return!1})}function nt(e,s,n,r,o,a){let l=[...e];return n&&(l=et(e,s)),typeof r=="string"&&r!==""&&(l=st(l,r)),tt[o](l,s,a)}function ie(e,s,n,r,o){const[a]=m(J);return Qe(()=>nt(e,s,n,a,r,o),[e,s,n,a,r,o])}const rt="_header_5pmv2_1",ot="_groupHead_5pmv2_5",at="_action_5pmv2_11",R={header:rt,groupHead:ot,action:at},lt="_proxy_5mgcm_1",ct="_now_5mgcm_25",it="_error_5mgcm_29",ut="_selectable_5mgcm_32",dt="_proxyType_5mgcm_40",xt="_row_5mgcm_51",pt="_proxyName_5mgcm_57",mt="_proxySmall_5mgcm_66",y={proxy:lt,now:ct,error:it,selectable:ut,proxyType:dt,row:xt,proxyName:pt,proxySmall:mt},ht="_proxyLatency_pw0sa_1",yt={proxyLatency:ht};function ft({latency:e,color:s}){let n=" ";if(e)switch(e.kind){case"Error":case"Testing":n="- ms";break;case"Result":n=(e.number!==0?e.number:"-")+" ms";break}return t.jsx("span",{className:yt.proxyLatency,style:{color:s},children:n})}const{useMemo:A}=f,g={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function ue(e){if(!e||e.kind!=="Result")return g.na;const s=e.number;return s===0?g.na:s<200?g.good:s<400?g.normal:typeof s=="number"?g.bad:g.na}function jt(e,s){return Q.indexOf(s)>-1?{border:"1px dotted #777"}:{background:ue(e)}}function _t({now:e,name:s,proxy:n,latency:r,isSelectable:o,onClick:a}){const l=A(()=>jt(r,n.type),[r,n]),c=A(()=>{let d=s;return r&&r.kind==="Result"&&typeof r.number=="number"&&(d+=" "+r.number+" ms"),d},[s,r]),i=w.useCallback(()=>{o&&a&&a(s)},[s,a,o]),u=A(()=>q(y.proxySmall,{[y.now]:e,[y.selectable]:o}),[o,e]),p=w.useCallback(d=>{d.key==="Enter"&&i()},[i]);return t.jsx("div",{title:c,className:u,style:l,onClick:i,onKeyDown:p,role:o?"menuitem":""})}function vt(e){return e==="Shadowsocks"?"SS":e}const bt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function Ct({children:e,label:s,"aria-label":n}){const[r,o]=ve();return t.jsxs(t.Fragment,{children:[w.cloneElement(e,r),t.jsx(be,{...o,label:s,"aria-label":n,position:bt})]})}function gt({now:e,name:s,proxy:n,latency:r,isSelectable:o,onClick:a}){const l=A(()=>ue(r),[r]),c=w.useCallback(()=>{o&&a&&a(s)},[s,a,o]),i=w.useCallback(p=>{p.key==="Enter"&&c()},[c]),u=A(()=>q(y.proxy,{[y.now]:e,[y.selectable]:o}),[o,e]);return t.jsxs("div",{tabIndex:0,className:u,onClick:c,onKeyDown:i,role:o?"menuitem":"",children:[t.jsx("div",{className:y.proxyName,children:t.jsx(Ct,{label:s,"aria-label":"proxy name: "+s,children:t.jsx("span",{children:s})})}),t.jsxs("div",{className:y.row,children:[t.jsx("span",{className:y.proxyType,style:{opacity:e?.6:.2},children:vt(n.type)}),t.jsx(ft,{latency:r,color:l})]})]})}const de=(e,{name:s})=>{const n=ee(e),r=E(e);return{proxy:n[s]||{name:s,type:"Unknown",history:[]},latency:r[s]}},wt=S(de)(gt),Pt=S(de)(_t),kt="_list_1oy7w_1",Nt="_listSummaryView_1oy7w_8",xe={list:kt,listSummaryView:Nt};function pe({all:e,now:s,isSelectable:n,itemOnTapCallback:r}){const o=e;return t.jsx("div",{className:xe.list,children:o.map(a=>t.jsx(wt,{onClick:r,isSelectable:n,name:a,now:a===s},a))})}function me({all:e,now:s,isSelectable:n,itemOnTapCallback:r}){return t.jsx("div",{className:xe.listSummaryView,children:e.map(o=>t.jsx(Pt,{onClick:r,isSelectable:n,name:o,now:o===s},o))})}const{createElement:At,useCallback:O,useMemo:St}=f;function Tt({name:e,all:s,delay:n,proxies:r,type:o,now:a,apiConfig:l,dispatch:c}){const[i,u]=m(ne),p=i[`proxyGroup:${e}`],[d]=m(M),[j]=m(K),x=ie(s,n,j,d,r),h=St(()=>o==="Selector",[o]),{proxies:{requestDelayForProxies:T}}=te(),P=O((C,ye,fe)=>{u(je=>({...je,[`${C}:${ye}`]:fe}))},[u]),I=O(()=>{P("proxyGroup",e,!p)},[p,P,e]),[$]=m(re),b=O(C=>{h&&c(Ce(l,e,C,$))},[l,c,e,h,$]),_=se(!1),B=O(async()=>{if(!_.value){_.set(!0);try{await T(l,x)}catch{}_.set(!1)}},[x,l,T,_]);return t.jsxs("div",{className:R.group,children:[t.jsxs("div",{className:R.groupHead,children:[t.jsx(ce,{name:e,type:o,toggle:I,qty:x.length,isOpen:p}),t.jsx("div",{className:R.action,children:t.jsx(F,{label:"Test latency",children:t.jsx(v,{kind:"circular",onClick:B,children:t.jsx(le,{animate:_.value,size:16})})})})]}),At(p?pe:me,{all:x,now:a,isSelectable:h,itemOnTapCallback:b})]})}const $t=S((e,{name:s,delay:n})=>{const r=ee(e),o=r[s],{all:a,type:l,now:c}=o;return{all:a,delay:n,proxies:r,type:l,now:c}})(Tt),{useCallback:he,useState:Lt}=f;function Ot({dispatch:e,apiConfig:s,name:n}){return he(()=>e(ge(s,n)),[s,e,n])}function Dt({dispatch:e,apiConfig:s,names:n}){const[r,o]=Lt(!1);return[he(async()=>{if(!r){o(!0);try{await e(we(s,n))}catch{}o(!1)}},[s,e,n,r]),r]}const{useState:Ft,useCallback:It}=f;function Bt({isLoading:e}){return e?t.jsx(Be,{children:t.jsx(G,{width:16,height:16})}):t.jsx(G,{width:16,height:16})}function Rt({dispatch:e,apiConfig:s}){const[n,r]=Ft(!1),[o]=m(Pe);return[It(()=>{n||(r(!0),e(ke(s,o)).then(()=>r(!1),()=>r(!1)))},[s,e,n,o]),n]}function Ut({dispatch:e,apiConfig:s,proxyProviders:n}){const{t:r}=V(),[o,a]=Rt({dispatch:e,apiConfig:s}),[l,c]=Dt({apiConfig:s,dispatch:e,names:n.map(i=>i.name)});return t.jsx(De,{icon:t.jsx(Bt,{isLoading:a}),onClick:o,text:r("Test Latency"),style:Fe,children:n.length>0?t.jsx(Ie,{text:r("update_all_proxy_provider"),onClick:l,children:t.jsx(Re,{isRotating:c})}):null})}const Ht="_updatedAt_919yi_1",qt="_main_919yi_8",Et="_head_919yi_17",Mt="_action_919yi_23",Kt="_refresh_919yi_31",N={updatedAt:Ht,main:qt,head:Et,action:Mt,refresh:Kt},{useCallback:U}=f;function Vt({name:e,proxies:s,delay:n,vehicleType:r,updatedAt:o,dispatch:a}){const[l,c]=m(ne),i=l[`proxyProvider:${e}`],[u]=m(M),[p]=m(K),d=oe(),j=ie(s,n,p,u),x=se(!1),h=Ot({dispatch:a,apiConfig:d,name:e}),T=U(()=>{if(x.value)return;x.set(!0);const b=()=>x.set(!1);a(Ne(d,e)).then(b,b)},[d,a,e,x]),P=U((b,_,B)=>{c(C=>({...C,[`${b}:${_}`]:B}))},[c]),I=U(()=>{P("proxyProvider",e,!i)},[i,P,e]),$=qe(new Date(o),new Date);return t.jsxs("div",{className:N.main,children:[t.jsxs("div",{className:N.head,children:[t.jsx(ce,{name:e,toggle:I,type:r,isOpen:i,qty:j.length}),t.jsxs("div",{className:N.action,children:[t.jsx(F,{label:"Update",children:t.jsx(v,{kind:"circular",onClick:h,children:t.jsx(Zt,{})})}),t.jsx(F,{label:"Health Check",children:t.jsx(v,{kind:"circular",onClick:T,children:t.jsx(le,{animate:x.value,size:16})})})]})]}),t.jsx("div",{className:N.updatedAt,children:t.jsxs("small",{children:["Updated ",$," ago"]})}),i?t.jsx(pe,{all:j}):t.jsx(me,{all:j})]})}const zt={rest:{scale:1},pressed:{scale:.95}},Gt={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function Zt(){const s=Ae.read().motion;return t.jsx(s.div,{className:N.refresh,variants:zt,initial:"rest",whileHover:"hover",whileTap:"pressed",children:t.jsx(s.div,{className:"flexCenter",variants:Gt,children:t.jsx(Ue,{size:16})})})}const Yt=(e,{proxies:s})=>{const n=E(e);return{proxies:s,delay:n}},Wt=S(Yt)(Vt);function Xt({items:e}){return e.length===0?null:t.jsxs(t.Fragment,{children:[t.jsx(ae,{title:"Proxy Provider"}),t.jsx("div",{children:e.map(s=>t.jsx(Wt,{name:s.name,proxies:s.proxies,type:s.type,vehicleType:s.vehicleType,updatedAt:s.updatedAt},s.name))})]})}const Jt="_labeledInput_cmki0_1",H={labeledInput:Jt},Qt=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:W}=f;function es(){const[e,s]=m(re),[n,r]=m(M),[o,a]=m(K),l=W(u=>r(u.target.value),[r]),c=W(u=>{a(u)},[a]),{t:i}=V();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:H.labeledInput,children:[t.jsx("span",{children:i("sort_in_grp")}),t.jsx("div",{children:t.jsx(Ee,{options:Qt.map(u=>[u[0],i(u[1])]),selected:n,onChange:l})})]}),t.jsx("hr",{}),t.jsxs("div",{className:H.labeledInput,children:[t.jsx("label",{htmlFor:"hideUnavailableProxies",children:i("hide_unavail_proxies")}),t.jsx("div",{children:t.jsx(Z,{id:"hideUnavailableProxies",checked:o,onChange:c})})]}),t.jsxs("div",{className:H.labeledInput,children:[t.jsx("label",{htmlFor:"autoCloseOldConns",children:i("auto_close_conns")}),t.jsx("div",{children:t.jsx(Z,{id:"autoCloseOldConns",checked:e,onChange:s})})]})]})}function ts({color:e="currentColor",size:s=24}){return t.jsxs("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:s,height:s,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M2 6h9M18.5 6H22"}),t.jsx("circle",{cx:"16",cy:"6",r:"2"}),t.jsx("path",{d:"M22 18h-9M6 18H2"}),t.jsx("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const ss="_topBar_16fpp_1",ns="_topBarRight_16fpp_13",rs="_textFilterContainer_16fpp_22",os="_group_16fpp_29",D={topBar:ss,topBarRight:ns,textFilterContainer:rs,group:os},{useState:as,useEffect:ls,useCallback:X,useRef:cs}=f;function is({dispatch:e,groupNames:s,delay:n,proxyProviders:r,showModalClosePrevConns:o}){const a=oe(),l=cs({}),c=X(()=>{l.current.startAt=Date.now(),e(Se(a)).then(()=>{l.current.completeAt=Date.now()})},[a,e]);ls(()=>{c();const h=()=>{l.current.startAt&&Date.now()-l.current.startAt>3e4&&c()};return window.addEventListener("focus",h,!1),()=>window.removeEventListener("focus",h,!1)},[c]);const[i,u]=as(!1),p=X(()=>{u(!1)},[]),{proxies:{closeModalClosePrevConns:d,closePrevConnsAndTheModal:j}}=te(),{t:x}=V();return t.jsxs(t.Fragment,{children:[t.jsx(z,{isOpen:i,onRequestClose:p,children:t.jsx(es,{})}),t.jsxs("div",{className:D.topBar,children:[t.jsx(ae,{title:x("Proxies")}),t.jsxs("div",{className:D.topBarRight,children:[t.jsx("div",{className:D.textFilterContainer,children:t.jsx(He,{textAtom:J})}),t.jsx(F,{label:x("settings"),children:t.jsx(v,{kind:"minimal",onClick:()=>u(!0),children:t.jsx(ts,{size:16})})})]})]}),t.jsx("div",{children:s.map(h=>t.jsx("div",{className:D.group,children:t.jsx($t,{name:h,delay:n,apiConfig:a,dispatch:e})},h))}),t.jsx(Xt,{items:r}),t.jsx("div",{style:{height:60}}),t.jsx(Ut,{dispatch:e,apiConfig:a,proxyProviders:r}),t.jsx(z,{isOpen:o,onRequestClose:d,children:t.jsx(Ge,{onClickPrimaryButton:()=>j(a),onClickSecondaryButton:d})})]})}const us=e=>({groupNames:Te(e),proxyProviders:$e(e),delay:E(e),showModalClosePrevConns:Le(e)}),vs=S(us)(is);export{vs as default};
